APPLICATION testrunner
OBJS storageserver/dummystoragelink
OBJS testrunner testhelper
LIBS tests/persistence/memfile/testmemfiletop
LIBS tests/serverapp/testserverapp
LIBS tests/storageserver/teststorageserver
LIBS tests/bucketmover/testbucketmover
LIBS tests/storageutil/teststorageutil
LIBS tests/visiting/testvisiting
LIBS tests/bucketdb/testbucketdb
LIBS tests/common/testcommon
LIBS tests/common/hostreporter/testhostreporter
LIBS tests/distributor/testdistributor
LIBS tests/persistence/testpersistence
LIBS tests/persistence/device/testdevice
LIBS tests/persistence/filestorage/testfilestorage
LIBS tests/persistence/filestorage/slotfile/testslotfile
LIBS tests/splitting/testsplitting
LIBS tests/memorymanager/testmemorymanager

LIBS storage/storageserver/storageserver
LIBS storage/bucketmover/bucketmover
LIBS storage/visiting/visitor
LIBS storage/memorymanager/memorymanager
LIBS storage/persistence/persistence
LIBS storage/persistence/filestorage/filestorpersistence 
LIBS storage/persistence/memfile/memfiletop
LIBS storage/persistence/memfile/common/memfilecommon
LIBS storage/persistence/memfile/mapper/memfilemapper
LIBS storage/persistence/memfile/handler/memfilehandler
LIBS storage/persistence/memfile/memfile/memfile
LIBS storage/persistence/memfile/common/memfilecommon
LIBS storage/persistence/memfile/memfiletop
LIBS storage/storageutil/storageutil
LIBS storage/persistence/device/device
LIBS storage/persistence/filestorage/slotfile/slotfile
LIBS storage/bucketdb/bucketdb
LIBS storage/distributor/distributor
LIBS storage/common/common
LIBS storage/config/storageconfig
EXTERNALLIBS cppunit vdslib storageapi
EXTERNALLIBS document metrics boost_regex-mt-d
EXTERNALLIBS fast iconv 
EXTERNALLIBS vespa
EXTERNALLIBS config vespalog Judy vdslib documentapi vespalib
EXTERNALLIBS messagebus-test slobrokserver

CUSTOMMAKE

LIBDIR_TESTS=persistence/memfile:bucketdb:common:distributor:persistence:persistence/device:persistence/filestorage:persistence/filestorage/slotfile:serverapp:storageserver:storageutil:visiting:splitting:memorymanager:bucketmover

test:   all
	rm -f test.vlog
	VESPA_LOG_TARGET=file:test.vlog LD_LIBRARY_PATH=$(LIBDIR_BOOST_REGEX-MT-D):$(LIBDIR_DSTORE):$(LIBDIR_ICONV):$(LIBDIR_CPPUNIT):$(LIBDIR_TESTS):$(LD_LIBRARY_PATH) $(VALGRIND) ./testrunner --verbose $(TESTRUNARGS)

vtest:   all
	rm -f test.vlog
	VESPA_LOG_TARGET=file:test.vlog LD_LIBRARY_PATH=$(LIBDIR_BOOST_REGEX-MT-D):$(LIBDIR_DSTORE):$(LIBDIR_ICONV):$(LIBDIR_CPPUNIT):$(LIBDIR_TESTS):$(LD_LIBRARY_PATH) valgrind --leak-check=no ./testrunner --verbose

testdebug:   all
	rm -f test.vlog
	VESPA_LOG_TARGET=file:test.vlog LD_LIBRARY_PATH=$(LIBDIR_BOOST_REGEX-MT-D):$(LIBDIR_DSTORE):$(LIBDIR_ICONV):$(LIBDIR_CPPUNIT):$(LIBDIR_TESTS):$(LD_LIBRARY_PATH) gdb53 ./testrunner --verbose

testwithlog:   all
	LD_LIBRARY_PATH=$(LIBDIR_BOOST_REGEX-MT-D):$(LIBDIR_DSTORE):$(LIBDIR_ICONV):$(LIBDIR_CPPUNIT):$(LIBDIR_TESTS):$(LD_LIBRARY_PATH) ./testrunner --verbose

vtestwithlog:   all
	LD_LIBRARY_PATH=$(LIBDIR_BOOST_REGEX-MT-D):$(LIBDIR_DSTORE):$(LIBDIR_ICONV):$(LIBDIR_CPPUNIT):$(LIBDIR_TESTS):$(LD_LIBRARY_PATH) valgrind ./testrunner --verbose

stresstest:   all
	rm -f test.vlog
	VESPA_LOG_TARGET=file:test.vlog LD_LIBRARY_PATH=$(LIBDIR_BOOST_REGEX-MT-D):$(LIBDIR_DSTORE):$(LIBDIR_ICONV):$(LIBDIR_CPPUNIT):$(LIBDIR_TESTS):$(LD_LIBRARY_PATH) ./testrunner --verbose --includestress stress Stress

testverbose:   all
	rm -f test.vlog
	VESPA_LOG_TARGET=file:test.vlog LD_LIBRARY_PATH=$(LIBDIR_BOOST_REGEX-MT-D):$(LIBDIR_DSTORE):$(LIBDIR_ICONV):$(LIBDIR_CPPUNIT):$(LIBDIR_TESTS):$(LD_LIBRARY_PATH) ./testrunner --verbose

testall:   all
	rm -f test.vlog
	VESPA_LOG_TARGET=file:test.vlog LD_LIBRARY_PATH=$(LIBDIR_BOOST_REGEX-MT-D):$(LIBDIR_DSTORE):$(LIBDIR_ICONV):$(LIBDIR_CPPUNIT):$(LIBDIR_TESTS):$(LD_LIBRARY_PATH) $(VALGRIND) ./testrunner --verbose --includestress
